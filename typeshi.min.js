class TypeShi{constructor(){this.currentMode="alphas",this.currentLength="short",this.currentAccuracyTarget=70,this.masteredChars=[],this.availableChars=[],this.currentSequence="",this.userInput="",this.currentCharIndex=0,this.attempts=0,this.correctChars=0,this.totalChars=0,this.minAttemptsRequired=0,this.charSets={alphas:"abcdefghijklmnopqrstuvwxyz",alphanumeric:"abcdefghijklmnopqrstuvwxyz0123456789",symbols:"!@#$%^&*()_+-=[]{}|;:,.<>?",all:"abcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?"},this.lengthMappings={short:{min:3,max:5},medium:{min:5,max:8},long:{min:8,max:12},extra:{min:12,max:15}},this.learningOrder={alphas:"jfkdlsahgqwertyuiopzxcvbnm",alphanumeric:"jfkdlsahgqwertyuiopzxcvbnm1234567890",symbols:"!@#$%^&*()_+-=[]{}|;:,.<>?",all:"jfkdlsahgqwertyuiopzxcvbnm1234567890!@#$%^&*()_+-=[]{}|;:,.<>?"},this.init()}init(){this.setupEventListeners(),this.initializeAvailableChars(),this.generateNewSequence(),this.updateStats(),this.focusTypingArea()}initializeAvailableChars(){const e=this.learningOrder[this.currentMode];this.availableChars=[e[0]],this.masteredChars=[]}setupEventListeners(){document.querySelectorAll(".option-btn").forEach((e=>{e.addEventListener("click",(e=>this.handleOptionClick(e)))})),document.getElementById("rstBtn").addEventListener("click",(()=>this.reset())),document.getElementById("skipBtn").addEventListener("click",(()=>this.skip())),document.addEventListener("keydown",(e=>this.handleKeyPress(e))),document.addEventListener("click",(()=>this.focusTypingArea()))}handleOptionClick(e){const t=e.target,s=t.dataset.group,a=t.dataset.value;if("words"!==a){switch(document.querySelectorAll(`[data-group="${s}"]`).forEach((e=>{e.classList.remove("active")})),t.classList.add("active"),s){case"mode":this.currentMode=a,this.initializeAvailableChars();break;case"length":this.currentLength=a;break;case"accuracy":this.currentAccuracyTarget=parseInt(a),document.getElementById("target").textContent=`${a}%`}this.reset()}else alert("Word mode is not yet implemented. Please select another option.")}generateNewSequence(){if(0===this.availableChars.length)return void this.showCompletionMessage();const e=this.getSequenceLength();let t="";for(let s=0;s<e;s++){t+=this.availableChars[Math.floor(Math.random()*this.availableChars.length)],s<e-1&&Math.random()<.2&&(t+=" ")}this.currentSequence=t,this.calculateMinAttempts(),this.renderSequence()}calculateMinAttempts(){const e=this.lengthMappings[this.currentLength];this.minAttemptsRequired=e?e.min:3}getSequenceLength(){const e=this.lengthMappings[this.currentLength];if(!e)return 5;let t=e.max,s=e.min;return this.availableChars.length<=2&&(t=Math.min(t,6),s=Math.min(s,3)),Math.floor(Math.random()*(t-s+1))+s}renderSequence(){const e=document.getElementById("textDisplay");e.innerHTML="";for(let t=0;t<this.currentSequence.length;t++){const s=this.currentSequence[t],a=document.createElement("span");a.textContent=s,a.classList.add("char"),t===this.currentCharIndex?a.classList.add("current"):t<this.userInput.length&&(this.userInput[t]===s?a.classList.add("correct"):a.classList.add("incorrect")),e.appendChild(a)}}handleKeyPress(e){e.ctrlKey||e.altKey||e.metaKey||e.key.length>1&&"Backspace"!==e.key||(e.preventDefault(),"Backspace"===e.key?this.handleBackspace():1===e.key.length&&this.handleCharInput(e.key))}handleCharInput(e){this.currentCharIndex>=this.currentSequence.length||(this.userInput+=e,this.currentCharIndex++,this.totalChars++,e===this.currentSequence[this.currentCharIndex-1]&&this.correctChars++,this.renderSequence(),this.currentCharIndex>=this.currentSequence.length&&this.handleSequenceComplete(),this.updateStats())}handleBackspace(){if(this.currentCharIndex>0){const e=this.userInput[this.currentCharIndex-1],t=this.currentSequence[this.currentCharIndex-1];this.userInput=this.userInput.slice(0,-1),this.currentCharIndex--,this.totalChars--,e===t&&this.correctChars--,this.renderSequence(),this.updateStats()}}handleSequenceComplete(){this.attempts++;this.getAccuracy()>=this.currentAccuracyTarget&&this.attempts>=this.minAttemptsRequired&&this.advanceToNextStage(),setTimeout((()=>{this.generateNewSequence(),this.resetInput()}),500)}advanceToNextStage(){const e=this.learningOrder[this.currentMode],t=this.availableChars.length;if(t<e.length){const s=e[t];this.availableChars.push(s),this.attempts=0,this.correctChars=0,this.totalChars=0,console.log(`Advanced to stage ${t+1}. Available chars:`,this.availableChars.join(""))}}resetInput(){this.userInput="",this.currentCharIndex=0}reset(){this.attempts=0,this.correctChars=0,this.totalChars=0,this.initializeAvailableChars(),this.resetInput(),this.generateNewSequence(),this.updateStats()}skip(){this.advanceToNextStage(),this.generateNewSequence(),this.resetInput(),this.updateStats()}getAccuracy(){return this.totalChars>0?Math.round(this.correctChars/this.totalChars*100):0}updateStats(){document.getElementById("accuracy").textContent=`${this.getAccuracy()}%`,document.getElementById("attempts").textContent=this.attempts;const e=this.learningOrder[this.currentMode].length,t=this.availableChars.length;document.getElementById("mastered").textContent=`${t}/${e}`}showCompletionMessage(){document.getElementById("textDisplay").innerHTML='<span class="char correct">All characters mastered! Great job!</span>'}focusTypingArea(){document.querySelector(".typing-area").style.outline="none"}}document.addEventListener("DOMContentLoaded",(()=>{new TypeShi}));